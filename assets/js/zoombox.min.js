var scr=document.getElementsByTagName("script"),zoombox_path=scr[scr.length-1].getAttribute("src").replace("zoombox.js","");!function(m){var l,r,s,i,a,t,n,c={theme:"zoombox",opacity:.8,duration:800,animation:!0,width:600,height:400,gallery:!0,autoplay:!1,overflow:!1},d=!1,e=0,b="multimedia",h=!1,x=!1,p="closed",o='<div id="zoombox">             <div class="zoombox_mask"></div>            <div class="zoombox_container">                <div class="zoombox_content"></div>                <div class="zoombox_title"></div>                <div class="zoombox_next"></div>                <div class="zoombox_prev"></div>                <div class="zoombox_close"></div>            </div>            <div class="zoombox_gallery"></div>        </div>',z=/(\.jpg)|(\.jpeg)|(\.bmp)|(\.gif)|(\.png)/i,u=/(\.mp3)/i,f=/(\.flv)/i,w=/(\.swf)/i,g=/(\.mov)|(\.mp4)/i,v=/(\.wmv)|(\.avi)/i,y=/(http:\/\/www.dailymotion)|(http:\/\/dailymotion)/i,_=/(http:\/\/www.vimeo)|(http:\/\/vimeo)/i,k=/(youtube\.)/i,T=/(http:\/\/www\.koreus)|(http:\/\/koreus)/i;function j(){"closed"==p&&(d=!1),p="load",function(){if(i=c.width,a=c.height,null!=r){var o=/w([0-9]+)/.exec(r.attr("class"));null!=o&&o[1]&&(i=o[1]);var e=/h([0-9]+)/.exec(r.attr("class"));null!=e&&e[1]&&(a=e[1])}}(),z.test(s)?(img=new Image,img.src=s,m("body").append('<div id="zoombox_loader"></div>'),m("#zoombox_loader").css("marginTop",W()),t=window.setInterval(function(){!function(o){o.complete&&(e=0,window.clearInterval(t),i=o.width,a=o.height,m("#zoombox_loader").remove(),F(),I());m("#zoombox_loader").css({"background-position":"0px "+e+"px"}),(e-=40)<-440&&(e=0)}(img)},100)):(F(),I())}function C(){m("body").append(o),m(window).keydown(function(o){!function(o){37==o&&A();39==o&&P();27==o&&Y()}(o.which)}),m(window).resize(function(){m("#zoombox .zoombox_container").css({top:(E()-m("#zoombox .zoombox_container").outerHeight(!0))/2,left:(M()-m("#zoombox .zoombox_container").outerWidth(!0))/2})}),m("#zoombox .zoombox_mask").hide(),m("#zoombox").addClass(c.theme),m("#zoombox .zoombox_mask,.zoombox_close").click(function(){return Y(),!1}),0==x?m("#zoombox .zoombox_next,#zoombox .zoombox_prev").remove():(m("#zoombox .zoombox_next").click(function(){P()}),m("#zoombox .zoombox_prev").click(function(){A()}))}function O(){var i=0;if(c.gallery){if(!1===x)return m("#zoombox .zoombox_gallery").remove(),!1;for(var o in x){var e=zoombox_path+"img/video.png",t=m('<img src="'+e+'" class="video gallery'+1*o+'"/>');z.test(x[o].attr("href"))&&(e=x[o].attr("href"),t=m('<img src="'+e+'" class="gallery'+1*o+'"/>')),t.data("id",o).appendTo("#zoombox .zoombox_gallery"),t.click(function(){H(m(this).data("id")),m("#zoombox .zoombox_gallery img").removeClass("current"),m(this).addClass("current")}),o==h&&t.addClass("current"),m("<img/>").data("img",t).attr("src",e).on("load",function(){i++;var o=m(this).data("img");if(o.width(Math.round(o.height()*this.width/this.height)),i==m("#zoombox .zoombox_gallery img").length){var e=0;m("#zoombox .zoombox_gallery img").each(function(){e+=m(this).outerWidth(),m(this).data("left",e)});var t=m("<div>").css({position:"absolute",top:0,left:0,width:e});m("#zoombox .zoombox_gallery").wrapInner(t),m("#zoombox .zoombox_gallery").width(),m("#zoombox").trigger("change")}})}m("#zoombox .zoombox_gallery").show().animate({bottom:0},c.duration)}m("#zoombox").bind("change",function(o,e){if(m("#zoombox .zoombox_gallery div").width()<m("#zoombox .zoombox_gallery").width)return!0;var t=0,i=0;i=null!=e?(t=c.duration,e.width/2):m("#zoombox .zoombox_gallery").width()/2;var a=-m("#zoombox .zoombox_gallery img.current").data("left")+m("#zoombox .zoombox_gallery img.current").width()/2+i;a<2*i-m("#zoombox .zoombox_gallery div").width()&&(a=2*i-m("#zoombox .zoombox_gallery div").width()),0<a&&(a=0),m("#zoombox .zoombox_gallery div").animate({left:a},t)})}function I(){if(0==d?C():m("#zoombox .zoombox_title").empty(),m("#zoombox .close").hide(),m("#zoombox .zoombox_container").removeClass("multimedia").removeClass("img").addClass(b),null!=r&&r.attr("title")&&m("#zoombox .zoombox_title").append(r.attr("title")),m("#zoombox .zoombox_content").empty(),"img"==b&&0==d&&1==c.animation&&m("#zoombox .zoombox_content").append(n),null!=r&&0!=r.find("img").length&&0==d){var o=r.find("img");m("#zoombox .zoombox_container").css({width:o.width(),height:o.height(),top:o.offset().top,left:o.offset().left,opacity:0,marginTop:o.css("marginTop")})}else null!=r&&0==d?m("#zoombox .zoombox_container").css({width:r.width(),height:r.height(),top:r.offset().top,left:r.offset().left}):0==d&&m("#zoombox .zoombox_container").css({width:100,height:100,top:E()/2-50,left:M()/2-50});var e={width:i,height:a,left:(M()-i)/2,top:(E()-a)/2,marginTop:W(),opacity:1};m("#zoombox").trigger("change",e),1==c.animation?(m("#zoombox .zoombox_title").hide(),m("#zoombox .zoombox_close").hide(),m("#zoombox .zoombox_container").animate(e,c.duration,function(){"multimedia"!=b&&1!=d||m("#zoombox .zoombox_content").append(n),"image"!=b&&1!=d||m("#zoombox .zoombox_content img").css("opacity",0).fadeTo(300,1),m("#zoombox .zoombox_title").fadeIn(300),m("#zoombox .zoombox_close").fadeIn(300),p="opened",d||O(),d=!0}),m("#zoombox .zoombox_mask").fadeTo(200,c.opacity)):(m("#zoombox .zoombox_content").append(n),m("#zoombox .zoombox_close").show(),m("#zoombox .zoombox_gallery").show(),m("#zoombox .zoombox_container").css(e),m("#zoombox .zoombox_mask").show(),m("#zoombox .zoombox_mask").css("opacity",c.opacity),d||O(),d=!0,p="opened")}function Y(){p="closing",window.clearInterval(t),m(window).unbind("keydown"),m(window).unbind("resize"),"multimedia"==b&&m("#zoombox .zoombox_container").empty();var o={};if(null!=r&&0<r.find("img").length){var e=r.find("img");o={width:e.width(),height:e.height(),top:e.offset().top,left:e.offset().left,opacity:0,marginTop:e.css("marginTop")}}else o=null!=r?{width:r.width(),height:r.height(),top:r.offset().top,left:r.offset().left,marginTop:0,opacity:0}:{width:100,height:100,top:E()/2-50,left:M()/2-50,opacity:0};1==c.animation?(m("#zoombox .zoombox_mask").fadeOut(200),m("#zoombox .zoombox_gallery").animate({bottom:-m("#zoombox .zoombox_gallery").innerHeight()},c.duration),m("#zoombox .zoombox_container").animate(o,c.duration,function(){m("#zoombox").remove(),d=!(p="closed")})):(m("#zoombox").remove(),d=!(p="closed"))}function F(){0==c.overflow&&(1*i+50>M()&&(a=(M()-50)*a/i,i=M()-50),1*a+50>E()&&(i=(E()-50)*i/a,a=E()-50));var o=s;if(b="multimedia",z.test(o))b="img",n='<img src="'+s+'" width="100%" height="100%"/>';else if(u.test(o))i=300,a=40,n='<object type="application/x-shockwave-flash" data="'+MP3Player+"?son="+o+'" width="'+i+'" height="'+a+'">',n+='<param name="movie" value="'+MP3Player+"?son="+o+'" /></object>';else if(f.test(o)){var e=0;1==c.autoplay&&(e=1),n='<object type="application/x-shockwave-flash" data="'+zoombox_path+'FLVplayer.swf" width="'+i+'" height="'+a+'"><param name="allowFullScreen" value="true"><param name="scale" value="noscale"><param name="wmode" value="transparent"><param name="flashvars" value="flv='+o+"&autoplay="+e+'"><embed src="'+zoombox_path+'FLVplayer.swf" width="'+i+'" height="'+a+'" allowscriptaccess="always" allowfullscreen="true" flashvars="flv='+o+'" wmode="transparent" /></object>'}else if(w.test(o))n='<object width="'+i+'" height="'+a+'"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="'+o+'" /><embed src="'+o+'" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="'+i+'" height="'+a+'" wmode="transparent"></embed></object>';else if(g.test(o))n='<embed src="'+o+'" width="'+i+'" height="'+a+'" controller="true" cache="true" autoplay="true"/>';else if(v.test(o))n='<embed src="'+o+'" width="'+i+'" height="'+a+'" controller="true" cache="true" autoplay="true" wmode="transparent" />';else if(y.test(o)){t=(t=(t=o.split("_"))[0].split("/"))[t.length-1]+"?",1==c.autoplay&&(t+="autoPlay=1&"),n='<iframe frameborder="0" width="'+i+'" height="'+a+'" src="http://www.dailymotion.com/embed/video/'+t+'?wmode=transparent"></iframe>'}else if(_.test(o)){t=(t=o.split("/"))[3]+"?",1==c.autoplay&&(t+="autoplay=1&"),n='<iframe src="http://player.vimeo.com/video/'+t+'title=0&amp;byline=0&amp;portrait=0&amp;wmode=transparent" width="'+i+'" height="'+a+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}else if(k.test(o)){var t;t=(t=(t=o.split("watch?v="))[1].split("&"))[0]+"?",1==c.autoplay&&(t+="autoplay=1&"),n='<iframe width="'+i+'" height="'+a+'" src="http://www.youtube.com/embed/'+t+'wmode=Opaque" frameborder="0" allowfullscreen></iframe>'}else n=T.test(o)?'<object type="application/x-shockwave-flash" data="'+(o=(o=o.split(".html"))[0])+'" width="'+i+'" height="'+a+'"><param name="movie" value="'+o+'"><embed src="'+o+'" type="application/x-shockwave-flash" width="'+i+'" height="'+a+'"  wmode="transparent"></embed></object>':'<iframe src="'+o+'" width="'+i+'" height="'+a+'" border="0"></iframe>';return n}function H(o){return"opened"!=p||x&&(r=x[h=o],s=r.attr("href"),0<m("#zoombox .zoombox_gallery img").length&&(m("#zoombox .zoombox_gallery img").removeClass("current"),m("#zoombox .zoombox_gallery img:eq("+o+")").addClass("current")),j()),!1}function P(){(e=h+1)>x.length-1&&(e=0),H(e)}function A(){(e=h-1)<0&&(e=x.length-1),H(e)}function E(){return window.innerHeight?window.innerHeight:m(window).height()}function M(){return window.innerWidth?window.innerWidth:m(window).width()}function W(){return scrOfY=0,"number"==typeof window.pageYOffset?scrOfY=window.pageYOffset:document.body&&document.body.scrollTop?scrOfY=document.body.scrollTop:document.documentElement&&document.documentElement.scrollTop&&(scrOfY=document.documentElement.scrollTop),scrOfY}m.zoombox=function(o,e){},m.zoombox.options=c,m.zoombox.close=function(){Y()},m.zoombox.open=function(o,e){r=null,s=o,c=m.extend({},m.zoombox.options,e),j()},m.zoombox.html=function(o,e){n=o,c=m.extend({},m.zoombox.options,e),i=c.width,a=c.height,r=null,I()},m.fn.zoombox=function(n){return l=new Array,this.each(function(){if(m.browser&&m.browser.msie&&m.browser.version<7&&!window.XMLHttpRequest)return!1;var o=this,e=/zgallery([0-9]+)/.exec(m(this).attr("class")),t=/zskip/.exec(m(this).attr("class")),i=!1;if(null!=e){l[e[1]]||(l[e[1]]=new Array),null==t&&l[e[1]].push(m(this));var a=l[e[1]].length-1;i=l[e[1]]}m(this).unbind("click").click(function(){return c=m.extend({},m.zoombox.options,n),"closed"!=p||(null!=t?a<l[e[1]].length-1&&(r=l[e[1]][a+1]):r=m(o),x=i,s=r.attr("href"),h=a,j()),!1})})}}(jQuery);